(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2713:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,7970,23)),Promise.resolve().then(n.bind(n,5783))},5783:(e,t,n)=>{"use strict";n.d(t,{default:()=>k});var a=n(5155),r=n(2115),o=n(8060),i=n.n(o);n(6467);var s=n(1290),l=n(1027),c=n(3463),u=n(9795);let d=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-[color,box-shadow] disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40",outline:"border border-input bg-background shadow-xs hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function h(e){let{className:t,variant:n,size:r,asChild:o=!1,...i}=e,l=o?s.DX:"button";return(0,a.jsx)(l,{"data-slot":"button",className:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,u.QP)((0,c.$)(t))}(d({variant:n,size:r,className:t})),...i})}var g=n(1448);let p=[-71.076639,42.34268];function m(e){let{mapInstance:t}=e;return(0,a.jsx)(h,{className:"absolute top-52 right-4 z-10 bg-black text-white p-2 rounded-full shadow-md hover:bg-gray-800 transition w-14 h-14",onClick:()=>{t&&t.flyTo({center:p,zoom:11})},size:"icon",children:(0,a.jsx)(g.A,{style:{width:"32px",height:"32px"}})})}let f=["Red","Orange","Blue","Mattapan","Green-B","Green-C","Green-D","Green-E","CR-Fairmount","CR-Fitchburg","CR-Worcester","CR-Franklin","CR-Greenbush","CR-Haverhill","CR-Kingston","CR-Lowell","CR-Middleborough","CR-Needham","CR-Newburyport","CR-Providence","CR-Foxboro"];function v(e){let{map:t,activeFilters:n,onRoutesLoaded:a}=e,[o,i]=(0,r.useState)(new Map),[s,l]=(0,r.useState)(!1),c=(0,r.useCallback)(async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!(!t||o.has(e))){console.log("\uD83D\uDE86 [TrainPaths] Fetching route: ".concat(e," (Attempt ").concat(n,")"));try{let a=await fetch("".concat("https://api-v3.mbta.com","/routes/").concat(e,"?include=route_patterns.representative_trip.shape"));if(!a.ok){if(429===a.status){if(console.warn("⚠️ [TrainPaths] 429 for ".concat(e,", retrying...")),await b(500*n),n<20)return c(e,n+1);console.error("\uD83D\uDEA8 [TrainPaths] Max retries for ".concat(e,", skipping..."));return}throw Error("HTTP Error ".concat(a.status))}let r=await a.json(),o="#".concat(r.data.attributes.color||"888888"),s=r.included.filter(e=>"shape"===e.type);if(!s.length)throw Error("No shape data found for ".concat(e));let l={type:"FeatureCollection",features:s.map(e=>({type:"Feature",geometry:{type:"LineString",coordinates:function(e){let t=0,n=0,a=0,r=[];for(;t<e.length;){let o,i=0,s=0;do s|=(31&(o=e.charCodeAt(t++)-63))<<i,i+=5;while(o>=32);n+=1&s?~(s>>1):s>>1,i=0,s=0;do s|=(31&(o=e.charCodeAt(t++)-63))<<i,i+=5;while(o>=32);a+=1&s?~(s>>1):s>>1,r.push([a/1e5,n/1e5])}return r}(e.attributes.polyline)},properties:{shape_id:e.id,route_color:o}}))};i(t=>new Map(t.set(e,l)));let u="mbta-routes-".concat(e),d="mbta-lines-".concat(e);t.getSource(u)||(t.addSource(u,{type:"geojson",data:l}),t.addLayer({id:d,type:"line",source:u,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":["get","route_color"],"line-width":2}})),console.log("✅ [TrainPaths] Finished loading route: ".concat(e))}catch(t){if(console.error("❌ [TrainPaths] Error loading ".concat(e,": ").concat(t.message)),n<20)return console.log("\uD83D\uDD04 [TrainPaths] Retrying ".concat(e," in ").concat(500*n,"ms...")),await b(500*n),c(e,n+1);console.error("\uD83D\uDEA8 [TrainPaths] Max retries for ".concat(e,", skipping..."))}}},[t,o]);return(0,r.useEffect)(()=>{if(!t||s)return;let e=!1;return(async()=>{try{for(let t of f)if(e||(await c(t),await b(1),e))return;console.log("\uD83C\uDF89 [TrainPaths] All routes loaded successfully!"),l(!0),a()}catch(t){e||console.error("❌ [TrainPaths] Error loading all routes:",t)}})(),()=>{e=!0}},[t,c,s,a]),(0,r.useEffect)(()=>{t&&f.forEach(e=>{let a="mbta-lines-".concat(e);if(t.getLayer(a)){var r;let o=null===(r=n[e])||void 0===r||r;t.setLayoutProperty(a,"visibility",o?"visible":"none"),t.setPaintProperty(a,"line-opacity",o?1:.5)}})},[n,t]),null}function b(e){return new Promise(t=>setTimeout(t,e))}function x(e){let{activeFilters:t,toggleCategory:n,toggleLine:o,showAll:i}=e,[s,l]=(0,r.useState)(null),[c,u]=(0,r.useState)(!1),[d,g]=(0,r.useState)(null),p=["Orange","Red","Blue"],m=["Green-B","Green-C","Green-D","Green-E","Mattapan"],f=e=>e.every(e=>!t[e]),v=e=>{d&&clearTimeout(d),l(e),u(!0)},b=()=>{u(!1),g(setTimeout(()=>{c&&l(null)},50))};return(0,r.useEffect)(()=>{s||setTimeout(()=>{l(null)},50)},[s]),(0,a.jsxs)("div",{className:"absolute top-4 right-4 z-20 flex flex-col gap-2 p-3 bg-black rounded-lg shadow-md",children:[(0,a.jsxs)("div",{className:"relative flex items-center transition-opacity duration-300 ".concat(s&&"subway"!==s?"opacity-50":"opacity-100"),onMouseEnter:()=>v("subway"),onMouseLeave:()=>b(),children:["subway"===s&&(0,a.jsx)("div",{className:"absolute right-14 flex gap-2 p-2 bg-gray-800 rounded-lg shadow-lg transition-all duration-300",onMouseEnter:()=>v("subway"),onMouseLeave:()=>b(),children:p.map(e=>(0,a.jsx)("img",{src:"/icons/icon-".concat(e.toLowerCase(),"-line-default.svg"),alt:"".concat(e," line icon"),className:"h-8 w-8 flex transition-all duration-300 cursor-pointer max-w-[40px] max-h-[40px] object-contain ".concat(t[e]?"opacity-100":"opacity-50"),onClick:()=>o(e)},e))}),(0,a.jsx)(h,{className:"relative h-8 w-8 flex items-center justify-center transition-transform duration-300 ".concat("subway"===s?"scale-125":"scale-100"," ").concat(f(p)?"opacity-50":"opacity-100"),onClick:()=>n("subway"),children:(0,a.jsx)("img",{src:"/icons/icon-mode-subway-small.svg",alt:"subway-icon",className:"w-8 h-8 max-w-[40px] max-h-[40px] object-contain"})})]}),(0,a.jsxs)("div",{className:"relative flex items-center transition-opacity duration-300 ".concat(s&&"lightrail"!==s?"opacity-50":"opacity-100"),onMouseEnter:()=>v("lightrail"),onMouseLeave:()=>b(),children:["lightrail"===s&&(0,a.jsx)("div",{className:"absolute right-14 flex gap-2 p-2 bg-gray-800 rounded-lg shadow-lg transition-all duration-300",onMouseEnter:()=>v("lightrail"),onMouseLeave:()=>b(),children:m.map(e=>{let n="";if(e.includes("Green")){let t=e.split("-")[1];n="/icons/icon-green-line-".concat(t.toLowerCase(),"-default.svg")}else"Mattapan"===e&&(n="/icons/icon-mattapan-line-default.svg");return(0,a.jsx)("img",{src:n,alt:"".concat(e," line icon"),className:"h-8 w-8 flex transition-all duration-300 cursor-pointer max-w-[40px] max-h-[40px] object-contain ".concat(t[e]?"opacity-100":"opacity-50"),onClick:()=>o(e)},e)})}),(0,a.jsx)(h,{className:"relative h-8 w-8 flex items-center justify-center bg-white rounded-full transition-transform duration-300 ".concat("lightrail"===s?"scale-125":"scale-100"," ").concat(f(m)?"opacity-50":"opacity-100"),onClick:()=>n("lightrail"),children:(0,a.jsx)("img",{src:"/icons/icon-mode-trolley-small.svg",alt:"trolley-icon",className:"w-8 h-8 max-w-[40px] max-h-[40px] object-contain"})})]}),(0,a.jsx)("div",{className:"relative flex items-center transition-opacity duration-300 ".concat(s&&"commuter"!==s?"opacity-50":"opacity-100"),onMouseEnter:()=>v("commuter"),onMouseLeave:()=>b(),children:(0,a.jsx)(h,{className:"relative h-8 w-8 flex items-center justify-center transition-transform duration-300 ".concat("commuter"===s?"scale-125":"scale-100"," ").concat(f(["CR-Fairmount","CR-Fitchburg","CR-Worcester","CR-Franklin","CR-Greenbush","CR-Haverhill","CR-Kingston","CR-Lowell","CR-Middleborough","CR-Needham","CR-Newburyport","CR-Providence","CR-Foxboro"])?"opacity-50":"opacity-100"),onClick:()=>n("commuter"),children:(0,a.jsx)("img",{src:"/icons/icon-mode-commuter-rail-small.svg",alt:"commuter-icon",className:"w-8 h-8 max-w-[40px] max-h-[40px] object-contain"})})}),(0,a.jsxs)("div",{className:"relative flex items-center transition-opacity duration-300 ".concat(s&&"showAll"!==s?"opacity-50":"opacity-100"),onMouseEnter:()=>v("showAll"),onMouseLeave:()=>b(),children:["showAll"===s&&(0,a.jsx)("span",{className:"absolute right-14 whitespace-nowrap bg-black text-white py-1 px-2 rounded-md transition-all duration-300",children:"Show All"}),(0,a.jsx)(h,{variant:"outline",className:"rounded-full border h-8 w-8 flex items-center justify-center bg-white transition-transform duration-300 ".concat("showAll"===s?"scale-125":"scale-100"),onClick:i,children:"\uD83D\uDD04"})]})]})}function y(e){let{map:t,activeFilters:n}=e,a=(0,r.useRef)(new Map),o=(0,r.useRef)(null),s=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(!t)return;console.log("✅ useEffect triggered (Live Train Markers)");let e=async()=>{console.log("⏳ Fetching live train data...");try{let e=await fetch("".concat("https://api-v3.mbta.com","/vehicles?filter[route]=Red,Blue,Orange,Mattapan,Green-B,Green-C,Green-D,Green-E,CR-Fairmount,CR-Fitchburg,CR-Worcester,CR-Franklin,CR-Greenbush,CR-Haverhill,CR-Kingston,CR-Lowell,CR-Middleborough,CR-Needham,CR-Newburyport,CR-Providence,CR-Foxboro"));if(429===e.status){console.warn("⚠️ Rate limit hit (429). Skipping this fetch.");return}let r=await e.json(),o=JSON.stringify(r.data);if(s.current===o){console.log("\uD83D\uDD04 No change in train data. Skipping update.");return}s.current=o,console.log("✅ Fetch successful at ".concat(new Date().toLocaleTimeString())),r.data.forEach(e=>{let r=e.id,o=e.relationships.route.data.id,{latitude:s,longitude:l,label:c,bearing:u,carriages:d,updated_at:h}=e.attributes;if(!s||!l)return;let g=Math.round((Date.now()-new Date(h).getTime())/1e3),p=d?d.length:"N/A",m=d?d.map(e=>e.label).join(", "):"No data",f=o.includes("CR-")?"Car: ".concat(c,"\n            Route: ").concat(o,"\n            Last Ping: ").concat(g,"s ago\n          "):"Lead Car: ".concat(c,"\n            Route: ").concat(o,"\n            Cars: ").concat(p,"\n            Consist: ").concat(m,"\n            Last Ping: ").concat(g,"s ago\n          ");if(a.current.has(r))a.current.get(r).marker.setLngLat([l,s]).setRotation(u);else{var v,b;let e=document.createElement("div");e.style.backgroundImage="url(".concat("https://www.mbta.com/icon-svg/icon-vehicle-bordered-expanded.svg",")"),e.style.backgroundSize="contain",e.style.width="16px",e.style.height="16px",e.style.cursor="pointer";let c=document.createElement("div");c.className="train-tooltip",c.style.position="absolute",c.style.background="rgba(0, 0, 0, 0.75)",c.style.color="white",c.style.padding="4px 8px",c.style.borderRadius="4px",c.style.fontSize="12px",c.style.whiteSpace="nowrap",c.style.visibility="hidden",c.innerText=f,e.addEventListener("mouseenter",()=>{c.style.visibility="visible"}),e.addEventListener("mouseleave",()=>{c.style.visibility="hidden"});let d=new(i()).Marker({element:e}).setLngLat([l,s]).setRotation(u).addTo(t);null===(v=t.getCanvas().parentElement)||void 0===v||v.appendChild(c),d.getElement().addEventListener("mousemove",e=>{c.style.left="".concat(e.clientX+10,"px"),c.style.top="".concat(e.clientY-30,"px")}),a.current.set(r,{marker:d,route:o,visible:null===(b=n[o])||void 0===b||b,tooltip:c})}})}catch(e){console.error("❌ Error fetching live train locations:",e)}};return o.current||(e(),o.current=setInterval(e,2500)),()=>{console.log("\uD83D\uDED1 Cleanup: Clearing interval ONLY ON UNMOUNT"),o.current&&(clearInterval(o.current),o.current=null),a.current.forEach(e=>{let{tooltip:t}=e;t.remove()})}},[t]),(0,r.useEffect)(()=>{t&&a.current.forEach((e,t)=>{var r,o;let{marker:i,route:s,tooltip:l}=e,c=null===(o=n[s])||void 0===o||o,u=(null===(r=a.current.get(t))||void 0===r?void 0:r.visible)===!1;c&&u?(i.getElement().style.display="block",a.current.set(t,{marker:i,route:s,visible:!0,tooltip:l})):c||(i.getElement().style.display="none",a.current.set(t,{marker:i,route:s,visible:!1,tooltip:l}))})},[n]),null}var w=n(3473),C=n(6527);function R(e){let{map:t}=e,[n,o]=(0,r.useState)(11),[i,s]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{if(!t)return;t.setZoom(n);let e=()=>o(t.getZoom());return t.on("zoom",e),()=>{t.off("zoom",e)}},[t]),(0,a.jsxs)("div",{className:"absolute top-72 right-4 z-10 flex flex-col items-center gap-2 p-3 bg-black text-white rounded-lg shadow-md",onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:[i&&(0,a.jsxs)("div",{className:"absolute top-0 -translate-y-full mb-1 text-xs bg-gray-800 text-white px-2 py-1 rounded",children:["Zoom: ",n.toFixed(1)]}),(0,a.jsx)(h,{variant:"ghost",size:"icon",onClick:()=>{t&&t.zoomIn()},className:"text-white hover:bg-gray-700",children:(0,a.jsx)(w.A,{className:"w-10 h-10"})}),(0,a.jsx)("div",{className:"w-full h-[1px] bg-gray-500"}),(0,a.jsx)(h,{variant:"ghost",size:"icon",onClick:()=>{t&&t.zoomOut()},className:"text-white hover:bg-gray-700",children:(0,a.jsx)(C.A,{className:"w-10 h-10"})})]})}let j=[-71.0589,42.3601],N=[[-73.5081,41.237964],[-69.9285,42.8868]],E={subway:["Red","Orange","Blue"],lightrail:["Mattapan","Green-B","Green-C","Green-D","Green-E"],commuter:["CR-Fairmount","CR-Fitchburg","CR-Worcester","CR-Franklin","CR-Greenbush","CR-Haverhill","CR-Kingston","CR-Lowell","CR-Middleborough","CR-Needham","CR-Newburyport","CR-Providence","CR-Foxboro"]},k=()=>{let e=(0,r.useRef)(null),t=(0,r.useRef)(null),[n,o]=(0,r.useState)(!1),[s,l]=(0,r.useState)(!1),[c,u]=(0,r.useState)(()=>{let e={};return Object.values(E).flat().forEach(t=>e[t]=!0),Object.keys(E).forEach(t=>e[t]=!0),e});return(0,r.useEffect)(()=>{e.current&&!t.current&&(t.current=new(i()).Map({container:e.current,style:"https://api.maptiler.com/maps/6352c4b7-9417-48fc-b37e-a8e9154e1559/style.json?key=uAsV5el3HdBMKRqcz1p8",center:j,zoom:11}),t.current.setMaxBounds(N),t.current.on("load",()=>o(!0)))},[]),(0,a.jsxs)("div",{className:"relative w-full h-screen",children:[(0,a.jsx)("div",{ref:e,className:"w-full h-full"}),n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v,{map:t.current,activeFilters:c,onRoutesLoaded:()=>l(!0)}),s&&(0,a.jsx)(y,{map:t.current,activeFilters:c})]}),(0,a.jsx)(x,{activeFilters:c,toggleCategory:e=>{let t=!c[e];u(n=>{let a={...n,[e]:t};return E[e].forEach(e=>{a[e]=t}),a})},toggleLine:e=>{u(t=>({...t,[e]:!t[e]}))},showAll:()=>u(e=>{let t={...e};return Object.keys(t).forEach(e=>t[e]=!0),t})}),(0,a.jsx)(m,{mapInstance:t.current}),(0,a.jsx)(R,{map:t.current})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[466,600,348,441,587,358],()=>t(2713)),_N_E=e.O()}]);